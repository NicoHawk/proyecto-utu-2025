<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>P√°gina Principal</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="../styles/principal.css">
</head>
<body>
    <div class="top-bar">
        <img src="../img/logo.png" alt="Logo de la empresa" class="logo">
        <div class="top-right">
            <a href="index.php">Iniciar Sesi√≥n</a>
            <a href="registro.html">Registrarse</a>
            <!-- Selector de idioma -->
            <div class="language-selector closed">
                <button class="lang-btn" onclick="toggleLangMenu()">
                    <span class="flag">üåê</span>
                    <span id="currentLang">ES</span>
                    <span class="arrow">‚ñº</span>
                </button>
                <div id="langMenu" class="lang-menu hidden">
                    <button class="lang-option" onclick="changeLang('es')">
                        <span class="flag">üá™üá∏</span>
                        <span>Espa√±ol</span>
                    </button>
                    <button class="lang-option" onclick="changeLang('en')">
                        <span class="flag">üá∫üá∏</span>
                        <span>English</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="seccion seccion-1">
        <div class="titulo">Bienvenido a Gesti√≥n de Autos El√©ctricos</div>
        <div class="subtitulo">Encuentra cargadores, gestiona tu cuenta y explora autos el√©ctricos f√°cilmente.</div>
    </div>
    <div class="seccion seccion-2">
        <div class="info-map-row">
            <div class="info">
                <h2>¬øPor qu√© elegirnos?</h2>
                <p>
                    Nuestra plataforma te permite localizar cargadores para autos el√©ctricos, gestionar tu informaci√≥n y descubrir los mejores modelos del mercado.<br>
                    ¬°√önete a la movilidad sostenible!
                </p>
            </div>
            <div>
                <div class="map-title">Cargadores Cercanos</div>
                <div id="map"></div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Toggle men√∫ de idioma
        function toggleLangMenu() {
            const menu = document.getElementById('langMenu');
            const selector = document.querySelector('.language-selector');
            menu.classList.toggle('hidden');
            if (menu.classList.contains('hidden')) {
                selector.classList.add('closed');
            } else {
                selector.classList.remove('closed');
            }
        }

        // Cambiar idioma
        function changeLang(lang) {
            const currentLangSpan = document.getElementById('currentLang');
            if (lang === 'es') {
                currentLangSpan.textContent = 'ES';
                document.querySelector('.titulo').textContent = 'Bienvenido a Gesti√≥n de Autos El√©ctricos';
                document.querySelector('.subtitulo').textContent = 'Encuentra cargadores, gestiona tu cuenta y explora autos el√©ctricos f√°cilmente.';
                document.querySelector('.info h2').textContent = '¬øPor qu√© elegirnos?';
                document.querySelector('.info p').innerHTML = 'Nuestra plataforma te permite localizar cargadores para autos el√©ctricos, gestionar tu informaci√≥n y descubrir los mejores modelos del mercado.<br>¬°√önete a la movilidad sostenible!';
                document.querySelector('.map-title').textContent = 'Cargadores Cercanos';
                document.querySelectorAll('.top-right a')[0].textContent = 'Iniciar Sesi√≥n';
                document.querySelectorAll('.top-right a')[1].textContent = 'Registrarse';
            } else if (lang === 'en') {
                currentLangSpan.textContent = 'EN';
                document.querySelector('.titulo').textContent = 'Welcome to Electric Car Management';
                document.querySelector('.subtitulo').textContent = 'Find chargers, manage your account and explore electric cars easily.';
                document.querySelector('.info h2').textContent = 'Why choose us?';
                document.querySelector('.info p').innerHTML = 'Our platform allows you to locate chargers for electric cars, manage your information and discover the best models on the market.<br>Join sustainable mobility!';
                document.querySelector('.map-title').textContent = 'Nearby Chargers';
                document.querySelectorAll('.top-right a')[0].textContent = 'Sign In';
                document.querySelectorAll('.top-right a')[1].textContent = 'Sign Up';
            }
            toggleLangMenu();
        }

        // Cerrar men√∫ al hacer clic fuera
        document.addEventListener('click', function(e) {
            const selector = document.querySelector('.language-selector');
            const menu = document.getElementById('langMenu');
            if (selector && !selector.contains(e.target)) {
                menu.classList.add('hidden');
                selector.classList.add('closed');
            }
        });

        // Obtener cargadores desde el backend usando la API
        fetch('../api/cargadores.php?accion=listar')
            .then(response => response.json())
            .then(cargadores => {
                let center = cargadores.length > 0
                    ? [cargadores[0].latitud, cargadores[0].longitud]
                    : [-34.6037, -58.3816];

                var map = L.map('map').setView(center, 12);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                cargadores.forEach(function(c) {
                    L.marker([c.latitud, c.longitud]).addTo(map)
                        .bindPopup('<b>' + c.nombre + '</b>');
                });
            })
            .catch(() => {
                var map = L.map('map').setView([-34.6037, -58.3816], 11);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
            });
    </script>
</body>
</html>